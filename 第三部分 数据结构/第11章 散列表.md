## 第11章 散列表

许多应用都需要一种动态集合结构，它至少要支持插入，搜索和删除字典操作。散列表是实现字典操作的一种有效的数据结构。尽管在最坏情况下，散列表中查找一个元素的时间复杂度达到了O(n)。然而在实际应用中，散列表查找的性能是极好的。在一些合理的假设下，散列表的平均时间复杂度是O(1)。

散列表是普通数组概念的推广。当实际存储的关键字数目比全部的可能关键字总数要小时，采用散列表就成为直接数组寻址的一种有效替代，因为散列表使用一个长度与实际存储关键字数目成比例的数组来存储。**在散列表中，不是直接把关键字作为数组的下标，而是根据关键字计算出相应的下标**。但是这个方法有个问题是会产生“冲突”。所谓冲突，就是指多个关键字映射到数组的同一个下标。散列是一个极其实用和有效的技术：基本的字典操作只需要O(1)的时间。

完全散列是如何能够在O(1)的最坏情况内完成关键字查找。

### 11.1 直接寻址表

当关键字的全域U比较小时，直接寻址是一种简单而有效的技术。这里假设没有两个元素具有相同的关键字。

为了表示动态集合，我们使用一个数组，或者称为**直接寻址表**。其中的每个位置，称为**槽**。

### 11.2 散列表

直接寻址的技术缺点是很明显的：如果全域U很大，则在一台标准的计算机可用内存容量中，几乎是不可能的。

在散列方式中，该元素存放在槽中h(k)；即利用散列函数h(k)，由关键字k计算出槽的位置。

这里存在一个问题：两个关键字可能映射到同一个槽中。我们称这种情形为**冲突**。

为了解决冲突，一个想法就是尽可能的使散列函数产生的值随机化。实际上，术语“散列”的愿意就是随机混杂和拼凑，即体现了这种思想。但是想完全避免冲突是不可能的。因此，我们一方面可以通过精心设计的散列函数来减少冲突的次数，另一方面仍需要有解决可能出现冲突的办法。

余下的部分介绍一种最简单的冲突解决办法：链接法。

##### 通过链接法解决冲突

**在链接法中，把散列到同一个槽中的所有元素放进一个链表中**。插入操作的最坏运行情况时间为O(1)。插入过程在某种程度上要快一些，因为假设待插入的的元素x没有出现在表中；查找操作的最坏运行时间与指定槽中的链表的长度成正比。

双链表的删除操作比较快速一些。但是会占用一个指针的额外空间。

一个链表的平均存储元素数称为**装载因子**。

用链接法散列的最坏情况性能很差：所有的关键字如果都散列在同一个槽中，从而产生出一个长度为n的链表。这时，最坏情况的查找时间变成了O(n)。

散列方法的平均性能依赖于所选取的散列函数。

在简单均匀散列的假设下，对于用链接法解决冲突的散列表，一次成功查找的平均时间为O(1 + a)。

### 11.3 散列函数

本节将讨论一些关于如何设计好的散列函数的问题。并介绍三种具体的方法。

##### 好的散列函数的特点

一个好的散列函数应满足简单均匀散列假设：每个关键字都被等可能的散列到m个槽位中的任何一个。但是一般来说无法检测这一条是否成立，因为很少能知道关键字散列所满足的概率分布，而且各关键字可能并不是完全独立的。

##### 将关键字散列为自然数

很多散列函数都假定关键字的全域为自然数。我们在后面的内容中，假定所给的关键字都是自然数。

#### 11.3.1 除法散列法

即散列函数为：**h(k) = k % m**

这代表将关键字k映射到m个槽中的某一个位置上，m代表了散列表的大小。当使用该方法时，m不应为2的幂。而一个不太接近2的整数幂的素数，常常是m的一个较好的选择。

#### 11.3.2 乘法散列法

构造散列函数的乘法散列法包含两个步骤。**第一步，使用关键字k乘上常数A(0 < A < 1)，并提取kA的小数部分。第二步，用m乘以这个值，再向下取整**。

乘法散列法的一个优点就是对m的选择不是特别的挑剔。Knuth认为大约是 (sqrt(5) - 1) / 2 最合适。

#### 练习

**11.3-1** 假设我们希望查找一个长度为n的链表，其中每一个元素都包含一个关键字k并具有散列值h(k)。每一个关键字都是长字符串。那么在表中查找具有给定关键字的元素时，如何利用个元素的散列值呢？

```
将关键字k传入散列函数中，然后进行列表查找即可。
```

### 11.4 开放寻址法

在开放寻址法中，所有的元素都存放在散列表中。也就是说，每个表项或包含一个动态集合的一个元素，或者包含NULL。当查找一个元素时，要系统的检查所有的表项，直到找到所需的元素，或者最终查明该元素不在表中。不像链接法，这里既没有链表，也没有元素存放在散列表外。因此在开放寻址法中，散列表可能被填满，以至于不能插入任何的新元素。该方法导致的一个结果便是装载因子绝对不会超过1。

这种方法存储函数要么返回关键字k的存储槽位，要么因为散列表已满而返回出错的标志。
